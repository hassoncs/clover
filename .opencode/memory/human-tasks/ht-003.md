# Human Task: RevenueCat IAP Setup

**ID**: ht-003  
**Priority**: HIGH (Launch Blocker)  
**Status**: PENDING  
**Created**: 2026-01-26  
**Source**: .sisyphus/plans/credit-system-implementation.md (tasks 6.1, 6.5)

## Summary

Set up RevenueCat account and configure IAP products for Slopcade Sparks purchases.

## Prerequisites Completed (by AI)

- [x] `react-native-purchases` package installed
- [x] `SparksPurchaseSheet` UI component created
- [x] `/webhooks/revenuecat` endpoint created
- [x] `economy.processPurchase` tRPC endpoint ready
- [x] Database tables ready (`iap_products`, `iap_purchases`)
- [x] `WalletService.credit()` for granting Sparks

## Human Actions Required

### Step 1: Create RevenueCat Account
1. Go to https://www.revenuecat.com/
2. Create account and new project "Slopcade"
3. Note the API keys for iOS and Android

### Step 2: Configure App Store Connect (iOS)
1. Create IAP products in App Store Connect:
   - `com.slopcade.sparks.starter` - $0.99 (500 Sparks)
   - `com.slopcade.sparks.creator` - $4.99 (2,750 Sparks, 10% bonus)
   - `com.slopcade.sparks.studio` - $19.99 (12,000 Sparks, 20% bonus)
2. Link to RevenueCat

### Step 3: Configure Google Play Console (Android)
1. Create IAP products matching iOS SKUs
2. Link to RevenueCat

### Step 4: Configure Webhook
1. In RevenueCat dashboard, set webhook URL:
   - Production: `https://api.slopcade.com/webhooks/revenuecat`
   - Staging: `https://api-staging.slopcade.com/webhooks/revenuecat`
2. Copy webhook signing secret
3. Set `REVENUECAT_WEBHOOK_SECRET` in Cloudflare Workers secrets

### Step 5: Update App Code
1. Add RevenueCat API keys to app config
2. Initialize `react-native-purchases` in app startup
3. Connect `SparksPurchaseSheet` to actual purchase flow

### Step 6: Test
1. Deploy to TestFlight (iOS) / Internal Testing (Android)
2. Test purchase flow with sandbox accounts
3. Verify webhook receives events
4. Verify Sparks are credited

## Files to Update

| File | Change |
|------|--------|
| `app/app/_layout.tsx` | Initialize RevenueCat SDK |
| `app/components/economy/SparksPurchaseSheet.tsx` | Replace placeholder with real purchase calls |
| Cloudflare Workers secrets | Add `REVENUECAT_WEBHOOK_SECRET` |

## Reference

- RevenueCat Docs: https://docs.revenuecat.com/
- Product catalog: `api/src/economy/pricing.ts` (IAP_PRODUCT_CATALOG)
- Webhook handler: `api/src/routes/webhooks/revenuecat.ts`
